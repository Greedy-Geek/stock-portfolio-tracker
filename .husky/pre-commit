#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check if API files changed and remind about docs
if git diff --cached --name-only | grep -q "app/api/"; then
  echo ""
  echo "âš ï¸  API files changed. Please ensure you update:"
  echo "   ğŸ“¡ API_DOCUMENTATION.md"
  echo "   ğŸ“š README.md (if public API changed)"
  echo "   ğŸ—ï¸  ARCHITECTURE.md (if data flow changed)"
  echo ""
fi

# Check if components changed and remind about docs
if git diff --cached --name-only | grep -q "components/\|app/page.tsx\|app/layout.tsx"; then
  echo ""
  echo "âš ï¸  Component files changed. Please ensure you update:"
  echo "   ğŸ“š README.md (component documentation)"
  echo "   ğŸ—ï¸  ARCHITECTURE.md (component hierarchy/data flow)"
  echo ""
fi

# Check if config files changed
if git diff --cached --name-only | grep -E "(next.config|package.json|tsconfig|vercel.json)" -q; then
  echo ""
  echo "âš ï¸  Configuration files changed. Please ensure you update:"
  echo "   ğŸš€ DEPLOYMENT.md (build/deployment configs)"
  echo "   ğŸ¤ CONTRIBUTING.md (development setup)"
  echo "   ğŸ“š README.md (if dependencies changed)"
  echo ""
fi

# Check if environment variables were added/changed
if git diff --cached --name-only | grep -q "\.env\|route\.ts"; then
  echo ""
  echo "âš ï¸  Environment or API files changed. Please ensure:"
  echo "   ğŸ“ All new environment variables are documented"
  echo "   ğŸ” Sensitive data is not committed"
  echo "   ğŸ“š README.md includes setup instructions"
  echo ""
fi

# Run documentation validation
echo "ğŸ“š Validating documentation..."
if [ -f "scripts/validate-docs.js" ]; then
  node scripts/validate-docs.js
  if [ $? -ne 0 ]; then
    echo ""
    echo "âŒ Documentation validation failed!"
    echo "   Please fix the issues above before committing."
    echo "   See DOCUMENTATION_MAINTENANCE.md for guidance."
    exit 1
  fi
else
  echo "âš ï¸  Documentation validation script not found"
fi

# Run linting
echo ""
echo "ğŸ” Running ESLint..."
pnpm lint
if [ $? -ne 0 ]; then
  echo "âŒ Linting failed! Please fix the issues above."
  exit 1
fi

# Run type checking
echo ""
echo "ğŸ” Running TypeScript type check..."
pnpm type-check
if [ $? -ne 0 ]; then
  echo "âŒ Type checking failed! Please fix the issues above."
  exit 1
fi

echo ""
echo "âœ… All pre-commit checks passed!"
echo "ğŸ“š Don't forget to update documentation if needed!"
echo ""
